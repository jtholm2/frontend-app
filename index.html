<html>

<head>
	<meta charset="utf-8"/>
	<title>JT's Website</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="stylesheet" href="stylesheets/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
   <style>#mapid { height: 2000px; }</style>
</head>

<body>
  <h1>Current Location of the ISS</h1>
  <p>
    latitude: <span id="lat"></span><br />
    longitude: <span id="lon"></span>
  </p>
  <button onclick="getData()">ISS Location</button>
  <!--<button onclick="getHistoricalData()">Historical Location Data</button>-->
  
  <div id="mapid"></div>

  <script>
    const mymap = L.map('mapid').setView([0, 0], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(mymap);

    async function getData() {
      const response = await fetch("http://api.open-notify.org/iss-now.json");
      const data = await response.json();
      const { latitude, longitude } = data["iss_position"];
      document.getElementById('lat').textContent = latitude;
      document.getElementById('lon').textContent = longitude;

      L.circleMarker([latitude,longitude]).addTo(mymap)
	      .bindPopup(
		    'ISS<br>'
	      )
	      .openPopup();
    }

    // async function getHistoricalData() {
    //     var coords = [];
    //add functionality to query data from Azure SQL db

    // }

    //add functionality to keep it running on a loop every hour and populate it in the Azure SQL db

  </script>
</body>
</html>